<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>WeChat测试</title>
		<style type="text/css">
			*{margin: 0; padding: 0;}
			h1{
				padding: 50px 0;
				text-align: center;
				color: #44b549;
				font-size: 16px;
			}
		</style>
	</head>
	<body>
		<div class="dome">
			<h1>这里是WeChat测试</h1>
		</div>
		
		
		<script src="js/jquery-1.12.4.js" type="text/javascript"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		
		<script type="text/javascript">
			var appID = "wx3c24ff62adc55b88";                      //开发者ID(AppID)
			var appsecret = "548c4ea93207b661aab7627839088352";    //开发者密码
			var current_url = encodeURIComponent(getCurrentUrl());			//当前url
			var code = GetQueryStr('code');
			console.log(code);
			//第一步：用户同意授权，获取code
			if(!code) { 											//静默授权：scope=snsapi_base  一般授权scope=snsapi_userinfo 
				var urls = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=' + appID + '&redirect_uri=' + current_url + '&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect';
				location.href = urls;
			}
			
			//第二步：通过code换取网页授权access_token
			var a_url = "https://api.weixin.qq.com/sns/oauth2/access_token?appid="+appID+"&secret="+appsecret+"&code="+code+"&grant_type=authorization_code";
			$.ajax({
				url:"http://query.yahooapis.com/v1/public/yql",
				dataType:"jsonp",
				data: {
					q: "select*from json where url=\'" + a_url + "'",
					format:'json'
				},
				success: function(data){
					console.log(data);
				},
				error: function(err){
					console.log(err);
				}
			});
			
			
			
			
			
			
			//name：参数名称，return：有则返回该参数对应值，没有则返回null
			function GetQueryStr(name){    
			    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			    var r = window.location.search.substr(1).match(reg);
			    if(r!=null)return  unescape(r[2]); return null;
			}
			
			function getCurrentUrl() {
				return location.href;
			}
			
		</script>
	</body>
</html>
